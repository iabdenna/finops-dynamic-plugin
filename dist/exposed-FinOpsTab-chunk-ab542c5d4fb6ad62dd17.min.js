"use strict";(self.webpackChunkfinops_plugin=self.webpackChunkfinops_plugin||[]).push([[157],{139:(e,t,n)=>{n.r(t),n.d(t,{default:()=>i});var o=n(271),a=n(879);const r=e=>(e?.data?.result??[]).map((e=>{const t=Number(e?.value?.[1]);return Number.isFinite(t)?{container:e.metric?.container??"",workload:e.metric?.workload??"",workload_type:e.metric?.workload_type??"",value:t}:null})).filter(Boolean),l=e=>e/1024**3,i=({obj:e})=>{const t=e?.metadata?.namespace??"",n=e?.metadata?.name??"",{limitQuery:i,usageQuery:d}=o.useMemo((()=>(e=>({limitQuery:`\nmax by (container, namespace, workload_type, workload) (\n  kube_pod_container_resource_limits{resource="memory", namespace="${e}", container!=""}\n  * on(namespace, pod) group_left(workload, workload_type)\n  namespace_workload_pod:kube_pod_owner:relabel{\n    namespace="${e}",\n    workload_type=~"deployment|statefulset|daemonset"\n  }\n)\n`.trim(),usageQuery:`\nmax by (container, namespace, workload_type, workload) (\n  max_over_time(\n    container_memory_working_set_bytes{\n      namespace="${e}",\n      container!="",\n      container!="POD"\n    }[7d]\n  )\n  * on(namespace, pod) group_left(workload, workload_type)\n  namespace_workload_pod:kube_pod_owner:relabel{\n    namespace="${e}",\n    workload_type=~"deployment|statefulset|daemonset"\n  }\n)\n`.trim()}))(t)),[t]),[m,s,c]=(0,a.usePrometheusPoll)({endpoint:a.PrometheusEndpoint.QUERY,query:i,namespace:t,delay:6e4}),[p,u,y]=(0,a.usePrometheusPoll)({endpoint:a.PrometheusEndpoint.QUERY,query:d,namespace:t,delay:6e4}),g=o.useMemo((()=>r(m).filter((e=>"deployment"===e.workload_type&&e.workload===n))),[m,n]),k=o.useMemo((()=>r(p).filter((e=>"deployment"===e.workload_type&&e.workload===n))),[p,n]),_=o.useMemo((()=>{const e=new Map;g.forEach((t=>e.set(t.container,t.value)));const t=new Map;return k.forEach((e=>t.set(e.container,e.value))),Array.from(new Set([...Array.from(e.keys()),...Array.from(t.keys())])).sort().map((n=>{const o=e.get(n),a=t.get(n);return{container:n,limitGiB:void 0!==o?l(o):null,usageGiB:void 0!==a?l(a):null}}))}),[g,k]),f=c||y,h=s||u;return o.createElement("div",{style:{padding:16}},o.createElement("h2",{style:{marginTop:0}},"FinOps"),o.createElement("div",{style:{color:"#6a6e73",marginBottom:12}},"Deployment ",o.createElement("b",null,n)," in namespace ",o.createElement("b",null,t)),h&&0===_.length&&o.createElement("div",{style:{color:"#c9190b",marginBottom:12}},"Error querying Prometheus"),o.createElement("table",{style:{width:"100%",borderCollapse:"collapse",border:"1px solid #d2d2d2"}},o.createElement("thead",{style:{background:"#f5f5f5"}},o.createElement("tr",null,o.createElement("th",{style:{padding:8,textAlign:"left"}},"Container"),o.createElement("th",{style:{padding:8,textAlign:"right"}},"Max memory limit (GiB)"),o.createElement("th",{style:{padding:8,textAlign:"right"}},"Max memory usage (7d) (GiB)"))),o.createElement("tbody",null,f?o.createElement("tr",null,o.createElement("td",{colSpan:3,style:{padding:12}},"Loadingâ€¦")):0===_.length?o.createElement("tr",null,o.createElement("td",{colSpan:3,style:{padding:12}},"No data available for this Deployment")):_.map((e=>{const t=((e,t)=>{if(null===e||null===t||0===t)return{color:"#151515",fontWeight:400};const n=e/t;return n>=.9?{color:"#c9190b",fontWeight:600}:n>=.7?{color:"#f0ab00",fontWeight:600}:{color:"#151515",fontWeight:400}})(e.usageGiB,e.limitGiB);return o.createElement("tr",{key:e.container},o.createElement("td",{style:{padding:8,borderTop:"1px solid #eee"}},e.container||"(empty)"),o.createElement("td",{style:{padding:8,borderTop:"1px solid #eee",textAlign:"right"}},null!==e.limitGiB?e.limitGiB.toFixed(2):"N/A"),o.createElement("td",{style:{padding:8,borderTop:"1px solid #eee",textAlign:"right",color:t.color,fontWeight:t.fontWeight}},null!==e.usageGiB?e.usageGiB.toFixed(2):"N/A"))})))))}}}]);